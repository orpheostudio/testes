<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>ùë∫ùíÜùíèùíÇ ‚úß - Tecnologia com alma gentil</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6c5ce7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sena">
    <link rel="apple-touch-icon" href="https://i.imgur.com/ivFEqQU.png">
    <link rel="apple-touch-startup-image" href="https://i.imgur.com/ivFEqQU.png">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="description" content="Assistente AI multifuncional com chat, an√°lise de documentos, gera√ß√£o de imagens, c√≥digo e muito mais">

    <!-- Fontes e Bibliotecas -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

    <!-- Microsoft Clarity Analytics -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tlya8thx8r"); 
    </script>

    <style>
        :root {
            --primary: #6c5ce7; 
            --primary-dark: #4834d4;
            --primary-light: #a29bfe;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #d63031;
            --info: #0984e3;
            --bg-app: #f5f6fa;
            --bg-chat: #ffffff;
            --bg-card: #ffffff;
            --text-main: #2d3436;
            --text-secondary: #636e72;
            --cici-bubble: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            --cici-text: #ffffff;
            --user-bubble: #fab1a0;
            --user-text: #2d3436;
            --border-color: #dfe6e9;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 2px 8px rgba(0,0,0,0.12);
            --shadow-lg: 0 4px 15px rgba(0,0,0,0.15);
            --menu-bg: rgba(255, 255, 255, 0.98);
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
            --safe-area-left: env(safe-area-inset-left);
            --safe-area-right: env(safe-area-inset-right);
        }

        /* Tema Escuro para iPhone */
        @media (prefers-color-scheme: dark) {
            body:not(.alto-contraste) {
                --primary: #a29bfe;
                --primary-dark: #6c5ce7;
                --bg-app: #000000;
                --bg-chat: #1c1c1e;
                --bg-card: #2c2c2e;
                --text-main: #ffffff;
                --text-secondary: #98989f;
                --cici-bubble: linear-gradient(135deg, #6c5ce7 0%, #4834d4 100%);
                --user-bubble: #ff6b6b;
                --border-color: #38383a;
                --menu-bg: rgba(44, 44, 46, 0.95);
            }
        }

        /* Alto Contraste */
        body.alto-contraste {
            --primary: #ffffff;
            --primary-dark: #cccccc;
            --bg-app: #000000;
            --bg-chat: #000000;
            --bg-card: #000000;
            --text-main: #ffff00;
            --text-secondary: #ffff00;
            --cici-bubble: #ffff00;
            --cici-text: #000000;
            --user-bubble: #ffff00;
            --user-text: #000000;
            --border-color: #ffff00;
            --shadow-sm: 0 0 0 1px #ffff00;
        }

        /* Estilos para PWA */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            height: -webkit-fill-available;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            font-size: 17px;
            -webkit-text-size-adjust: 100%;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none;
        }

        /* Layout Principal - Otimizado para Safe Area */
        #tela-app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: -webkit-fill-available;
            max-height: 100vh;
            width: 100%;
            padding-top: var(--safe-area-top);
            padding-bottom: var(--safe-area-bottom);
            padding-left: var(--safe-area-left);
            padding-right: var(--safe-area-right);
        }

        /* Header com altura segura para dispositivos m√≥veis */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(30, 30, 40, 0.45);
    backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 0.5px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
            min-height: 44px;
            padding-top: max(8px, var(--safe-area-top));
        }

        /* Bot√µes com tamanho touch ideal */
        .menu-btn, .header-action {
            background: transparent;
            border: none;
            padding: 8px;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 10px;
            transition: var(--transition);
            -webkit-tap-highlight-color: transparent;
        }

        .menu-btn:active, .header-action:active {
            background: rgba(255,255,255,0.1);
            transform: scale(0.95);
        }

        .icone-menu, .icone-header {
            width: 22px;
            height: 22px;
            object-fit: contain;
        }

        .logo-area .logo {
            width: 36px;
            height: 36px;
            object-fit: contain;
        }

        /* Menu Lateral com gesto de arrastar */
        #overlay-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            touch-action: pan-y;
        }

        #overlay-menu.aberto {
            opacity: 1;
            pointer-events: all;
        }

        #side-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 280px;
            height: 100%;
            background: var(--menu-bg);
            z-index: 1001;
            transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.3);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            overflow-y: auto;
            padding-top: max(20px, var(--safe-area-top));
            padding-bottom: max(20px, var(--safe-area-bottom));
        }

        #side-menu.aberto { 
            left: 0; 
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 0.5px solid var(--border-color);
        }

        .menu-close {
            background: var(--danger);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            -webkit-tap-highlight-color: transparent;
        }

        .menu-item {
            background: none;
            border: none;
            color: var(--text-main);
            padding: 16px 14px;
            text-align: left;
            font-size: 16px;
            font-weight: 500;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
            transition: var(--transition);
            min-height: 44px;
            -webkit-tap-highlight-color: transparent;
        }

        .menu-item:active {
            background-color: var(--primary);
            color: white;
        }

        .toggle-switch {
            width: 52px;
            height: 32px;
            background: var(--border-color);
            border-radius: 16px;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
            margin-left: auto;
            flex-shrink: 0;
        }

        .toggle-switch.ativo {
            background: var(--success);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 28px;
            height: 28px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.ativo::after {
            left: 22px;
        }

        /* √Årea de Chat - Otimizada para dispositivos m√≥veis */
        #chat-container {
            flex: 1;
            padding: 12px 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: var(--bg-chat);
            scroll-behavior: smooth;
            min-height: 0;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        #chat-container::-webkit-scrollbar { 
            display: none;
        }

        /* Mensagens para dispositivos m√≥veis */
        .mensagem-wrapper {
            display: flex;
            flex-direction: column;
            max-width: 88%;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(8px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .cici-wrapper { 
            align-self: flex-start; 
        }

        .usuario-wrapper { 
            align-self: flex-end; 
            align-items: flex-end; 
        }

        .mensagem {
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            box-shadow: var(--shadow-sm);
            word-wrap: break-word;
            position: relative;
            font-size: 16px;
            word-break: break-word;
            -webkit-user-select: text;
            user-select: text;
        }

        .cici {
            background: var(--cici-bubble);
            color: var(--cici-text);
            border-bottom-left-radius: 6px;
        }

        .usuario {
            background-color: var(--user-bubble);
            color: var(--user-text);
            border-bottom-right-radius: 6px;
        }

        .mensagem-hora {
            font-size: 13px;
            opacity: 0.7;
            margin-top: 4px;
        }

        .mensagem-acoes {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .btn-acao {
            background: rgba(0,0,0,0.08);
            border: none;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 6px 10px;
            border-radius: 8px;
            transition: var(--transition);
            font-weight: 500;
            min-height: 32px;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-acao:active {
            background: var(--primary);
            color: white;
            transform: scale(0.96);
        }

        /* Sugest√µes para dispositivos m√≥veis */
        .sugestoes-container {
            padding: 10px 12px;
            background: linear-gradient(to top, rgba(20,20,28,0.95), rgba(20,20,28,0));
            flex-shrink: 0;
            border-top: 0.5px solid rgba(255,255,255,0.1);
        }

        .sugestoes-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scrollbar-width: none;
            padding-bottom: 2px;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-x: contain;
        }

        .sugestoes-scroll::-webkit-scrollbar {
            display: none;
        }

        .chip {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,0.12);
            border: 0.5px solid rgba(255,255,255,0.2);
            padding: 10px 14px;
            border-radius: 20px;
            color: #fff;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
            font-size: 15px;
            font-weight: 500;
            min-height: 36px;
            -webkit-tap-highlight-color: transparent;
        }

        .chip:active {
            background: rgba(255,255,255,0.2);
            transform: scale(0.96);
        }

        /* √Årea de Input para dispositivos m√≥veis */
        footer {
            background: var(--bg-chat);
            padding: 12px 10px;
            border-top: 0.5px solid var(--border-color);
            flex-shrink: 0;
            padding-bottom: max(12px, var(--safe-area-bottom));
        }

        .input-tools {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            overflow-x: auto;
            padding-bottom: 2px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-x: contain;
        }

        .input-tools::-webkit-scrollbar {
            display: none;
        }

        .tool-btn {
            background: var(--bg-card);
            border: 0.5px solid var(--border-color);
            color: var(--text-main);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            transition: var(--transition);
            font-weight: 500;
            flex-shrink: 0;
            min-height: 36px;
            -webkit-tap-highlight-color: transparent;
        }

        .tool-btn:active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(0.96);
        }

        .input-area {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .input-container {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        #entradaUsuario {
            width: 100%;
            max-height: 120px;
            min-height: 40px;
            resize: none;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 17px;
            line-height: 1.4;
            border: 0.5px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-main);
            caret-color: var(--primary);
            font-family: inherit;
            transition: var(--transition);
            -webkit-user-select: text;
            user-select: text;
            -webkit-appearance: none;
        }

        #entradaUsuario:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.15);
        }

        #entradaUsuario::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .input-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        #btn-mic, #btn-attach {
            background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
            color: white;
            width: 44px;
            height: 44px;
            min-width: 44px;
            border-radius: 50%;
            border: none;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            -webkit-tap-highlight-color: transparent;
        }

        #btn-attach {
            background: linear-gradient(135deg, #0984e3 0%, #74b9ff 100%);
        }

        #btn-mic:active, #btn-attach:active {
            transform: scale(0.92);
        }

        #btn-mic.ouvindo {
            background: linear-gradient(135deg, var(--success) 0%, #00b894 100%);
            animation: pulse 1.5s infinite;
        }

        .btn-send {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 0 20px;
            height: 44px;
            border-radius: 22px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            font-size: 16px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 70px;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-send:active {
            transform: scale(0.95);
        }

        .btn-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
            }
            50% { 
                transform: scale(1.05); 
            }
        }

        /* Modal para dispositivos m√≥veis */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            padding-top: max(20px, var(--safe-area-top));
            padding-bottom: max(20px, var(--safe-area-bottom));
        }

        .card-aviso {
            width: 100%;
            max-width: 320px;
            padding: 24px 20px;
            background: var(--bg-card);
            border: 0.5px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-main);
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: fadeZoom 0.3s ease;
        }

        @keyframes fadeZoom {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .aviso-titulo {
            font-size: 20px;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .aviso-lista {
            text-align: left;
            line-height: 1.5;
            font-size: 16px;
            margin: 16px 0 20px;
        }

        .btn-grande {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 16px 0;
            border-radius: 14px;
            border: none;
            color: white;
            font-size: 17px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            min-height: 50px;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-grande:active {
            transform: scale(0.98);
        }

        /* Toast para dispositivos m√≥veis */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            color: var(--text-main);
            padding: 14px 18px;
            border-radius: 14px;
            box-shadow: var(--shadow-lg);
            z-index: 1500;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            max-width: calc(100% - 32px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 0.5px solid var(--border-color);
            font-size: 15px;
            margin-bottom: max(80px, var(--safe-area-bottom));
        }

        .toast.mostrar {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .oculto { 
            display: none !important; 
        }

        /* Indicador de digita√ß√£o */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Melhorias de acessibilidade */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary);
            color: white;
            padding: 8px;
            border-radius: 4px;
            text-decoration: none;
            z-index: 10000;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Media Queries espec√≠ficas para dispositivos */
        /* iPhone SE e menores */
        @media (max-width: 320px) {
            .app-header {
                padding: 6px 10px;
            }

            #chat-container {
                padding: 10px 8px;
                gap: 10px;
            }

            .mensagem-wrapper {
                max-width: 92%;
            }

            .mensagem {
                padding: 10px 14px;
                font-size: 15px;
            }

            .sugestoes-container {
                padding: 8px 10px;
            }

            .chip {
                padding: 8px 12px;
                font-size: 14px;
            }

            footer {
                padding: 10px 8px;
            }

            #entradaUsuario {
                padding: 10px 14px;
                font-size: 16px;
            }

            .card-aviso {
                padding: 20px 16px;
            }

            .aviso-titulo {
                font-size: 18px;
            }
        }

        /* iPhone Plus e maiores */
        @media (min-width: 414px) {
            .app-header {
                padding: 10px 16px;
            }

            #chat-container {
                padding: 16px 14px;
            }

            .mensagem-wrapper {
                max-width: 85%;
            }

            footer {
                padding: 16px 14px;
            }
        }

        /* iPad */
        @media (min-width: 768px) {
            .app-header {
                padding: 12px 20px;
            }

            #chat-container {
                padding: 20px;
                max-width: 800px;
                margin: 0 auto;
                width: 100%;
            }

            .mensagem-wrapper {
                max-width: 80%;
            }

            footer {
                padding: 20px;
                max-width: 800px;
                margin: 0 auto;
                width: 100%;
            }
        }

        /* Suporte para orienta√ß√£o paisagem */
        @media (max-height: 400px) and (orientation: landscape) {
            .app-header {
                min-height: 40px;
                padding: 4px 12px;
            }

            #chat-container {
                padding: 8px 10px;
                gap: 8px;
            }

            .mensagem {
                padding: 8px 12px;
            }

            footer {
                padding: 8px 10px;
            }

            .sugestoes-container {
                display: none;
            }
        }

        /* Melhorias de acessibilidade iOS */
        button, input, textarea {
            -webkit-appearance: none;
            border-radius: 0;
        }

        input, textarea {
            font-size: 16px !important;
        }

        /* Prevenir sele√ß√£o de texto em elementos interativos */
        button, .chip, .tool-btn {
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        /* Feedback t√°til melhorado */
        @media (hover: none) and (pointer: coarse) {
            .menu-item:hover,
            .chip:hover,
            .tool-btn:hover,
            .btn-acao:hover {
                background: initial;
                transform: initial;
            }

            .menu-item:active,
            .chip:active,
            .tool-btn:active,
            .btn-acao:active {
                background: var(--primary);
                transform: scale(0.96);
            }
        }

        /* Estilos para tela de boas-vindas */
        .boas-vindas {
            text-align: center;
        }

        .logo-boas-vindas {
            margin-bottom: 20px;
            border-radius: 20px;
        }

        .titulo-boas-vindas {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .subtitulo-forte {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .subtitulo {
            font-size: 16px;
            margin-bottom: 24px;
            opacity: 0.8;
        }

        .aviso-links {
            margin-top: 16px;
            font-size: 14px;
        }

        .aviso-links a {
            color: var(--primary);
            text-decoration: none;
        }

        /* Estilos para anexos de arquivo */
        .file-attachment {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .file-icon {
            font-size: 24px;
        }

        .file-info {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 600;
        }

        .file-size {
            font-size: 12px;
            opacity: 0.7;
        }

        /* Estilos para c√≥digo */
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #2d2d2d;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            font-size: 14px;
            color: #ccc;
        }

        .code-language {
            font-weight: 600;
        }

        .code-copy-btn {
            background: #444;
            border: none;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .code-copy-btn:active {
            background: #666;
        }

        /* Estilos para menu dividers */
        .menu-divider {
            height: 1px;
            background: var(--border-color);
            margin: 12px 0;
        }

        .menu-titulo {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 16px 0 8px;
            padding: 0 14px;
        }

        /* Estilos para modo ativo nos bot√µes */
        .tool-btn.ativo {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Link de acessibilidade para pular para o conte√∫do principal -->
    <a href="#chat-container" class="skip-link">Pular para o chat</a>

    <!-- Overlay e Menu Lateral -->
    <div id="overlay-menu" onclick="fecharMenu()"></div>

    <nav id="side-menu" role="navigation" aria-label="Menu de configura√ß√µes">
        <div class="menu-header">
            <h2 style="margin:0; font-size:1.3em;">‚öôÔ∏è Configura√ß√µes</h2>
            <button class="menu-close" onclick="fecharMenu()" aria-label="Fechar menu">‚úï</button>
        </div>

        <div class="menu-titulo">üé® Apar√™ncia</div>
        <button class="menu-item" onclick="alternarTemaEscuro()">
            <span id="icone-tema">üåô</span>
            <span id="texto-tema">Modo Escuro</span>
            <div class="toggle-switch" id="toggle-tema"></div>
        </button>
        <button class="menu-item" onclick="alternarContraste()">
            <span>üåì</span>
            <span>Alto Contraste</span>
            <div class="toggle-switch" id="toggle-contraste"></div>
        </button>
        <button class="menu-item" onclick="alternarLeituraFacilitada()">
            <span>üìñ</span>
            <span>Leitura Facilitada</span>
            <div class="toggle-switch" id="toggle-leitura"></div>
        </button>

        <div class="menu-divider"></div>

        <div class="menu-titulo">üî§ Tamanho do Texto</div>
        <button class="menu-item" onclick="ajustarFonte(2)">
            <span>üîç</span>
            <span>Aumentar Letra</span>
        </button>
        <button class="menu-item" onclick="ajustarFonte(-2)">
            <span>üîé</span>
            <span>Diminuir Letra</span>
        </button>
        <button class="menu-item" onclick="resetarFonte()">
            <span>‚Ü©Ô∏è</span>
            <span>Tamanho Padr√£o</span>
        </button>

        <div class="menu-divider"></div>

        <div class="menu-titulo">üîä √Åudio</div>
        <button class="menu-item" onclick="alternarSom()">
            <span id="icone-som">üéôÔ∏è</span>
            <span id="texto-som">Ativar Voz</span>
            <div class="toggle-switch" id="toggle-som"></div>
        </button>
        <button class="menu-item" onclick="ajustarVelocidadeVoz(-0.2)">
            <span>üê¢</span>
            <span>Voz Mais Lenta</span>
        </button>
        <button class="menu-item" onclick="ajustarVelocidadeVoz(0.2)">
            <span>‚ö°</span>
            <span>Voz Mais R√°pida</span>
        </button>

        <div class="menu-divider"></div>

        <div class="menu-titulo">üìÇ A√ß√µes</div>
        <button class="menu-item" onclick="exportarConversa()">
            <span>üíæ</span>
            <span>Salvar Conversa</span>
        </button>
        <button class="menu-item" onclick="compartilharConversa()">
            <span>‚õìÔ∏è‚Äçüí•</span>
            <span>Compartilhar</span>
        </button>
        <button class="menu-item" onclick="imprimirConversa()">
            <span>üñ®Ô∏è</span>
            <span>Imprimir</span>
        </button>
        <button class="menu-item" onclick="limparChat()" style="color: var(--danger);">
            <span>üóëÔ∏è</span>
            <span>Limpar Conversa</span>
        </button>

        <div class="menu-divider"></div>

        <div class="menu-titulo">‚ùì Ajuda</div>
        <button class="menu-item" onclick="mostrarAjuda()">
            <span>üìö</span>
            <span>Como Usar</span>
        </button>
        <button class="menu-item" onclick="mostrarCapacidades()">
            <span>üöÄ</span>
            <span>O que posso fazer?</span>
        </button>
        <button class="menu-item" onclick="mostrarAtalhos()">
            <span>‚å®Ô∏è</span>
            <span>Atalhos de Teclado</span>
        </button>
    </nav>

    <!-- Tela de Boas-Vindas -->
    <div id="tela-boas-vindas" class="modal-overlay">
        <div class="card-aviso boas-vindas">
            <img src="https://i.imgur.com/ivFEqQU.png" 
                 width="110" 
                 alt="Logo Sena"
                 class="logo-boas-vindas">

            <h1 class="titulo-boas-vindas">üå∏ ùë∫ùíÜùíèùíÇ ‚úß</h1>

            <p class="subtitulo-forte">Tecnologia com alma gentil</p>
            <p class="subtitulo">Chat ‚Ä¢ An√°lise ‚Ä¢ C√≥digo ‚Ä¢ Imagens ‚Ä¢ Documentos</p>

            <button class="btn-grande" onclick="irParaAviso()">Come√ßar Agora</button>
        </div>
    </div>

    <!-- Tela de Avisos -->
    <div id="tela-aviso" class="modal-overlay oculto">
        <div class="card-aviso">
            <h2 class="aviso-titulo">‚ö†Ô∏è Informa√ß√µes Importantes</h2>

            <div class="aviso-lista">
                <p><strong>‚úì</strong> Sou uma assistente IA em desenvolvimento</p>
                <p><strong>‚úì</strong> Posso cometer erros ‚Äî verifique informa√ß√µes cr√≠ticas</p>
                <p><strong>‚úì</strong> N√£o compartilhe senhas ou dados banc√°rios</p>
                <p><strong>‚úì</strong> Suas conversas s√£o salvas localmente</p>
                <p><strong>‚úì</strong> Posso analisar documentos(beta), gerar c√≥digo e muito mais</p>
            </div>

            <button class="btn-grande" onclick="irParaChat()">Entendi e Aceito</button>

            <div class="aviso-links">
                <a href="https://termos.orpheostudio.com.br" target="_blank">Termos de Uso</a> |
                <a href="https://politicas.orpheostudio.com.br" target="_blank">Pol√≠tica de Privacidade</a>
            </div>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="tela-app" class="oculto" style="display:flex; flex-direction:column; height:100%">
        <header class="app-header">
            <button class="menu-btn" onclick="abrirMenu()" aria-label="Abrir menu">
                <img src="https://i.imgur.com/6hl6JoA.png" alt="Menu" class="icone-menu">
            </button>

            <div class="logo-area">
                <img src="https://i.imgur.com/ivFEqQU.png" alt="Sena" class="logo">
            </div>

            <button class="header-action sena-btn" 
                    onclick="novaConversa()" 
                    aria-label="Nova conversa" 
                    title="Nova conversa">
                <img src="https://i.imgur.com/FsXkN6B.png" alt="Nova conversa" class="icone-header">
            </button>
        </header>

        <div id="chat-container" role="main" aria-live="polite" aria-label="√Årea de conversa"></div>

        <div class="sugestoes-container">
            <div class="sugestoes-scroll" id="chips-sugestoes">
                <button class="chip" onclick="usarChip('Explique de forma simples:')">
                    <span>üéØ</span> Explica√ß√£o Simples
                </button>
                <button class="chip" onclick="usarChip('Crie um c√≥digo em Python para:')">
                    <span>üíª</span> Gerar C√≥digo
                </button>
                <button class="chip" onclick="usarChip('Analise este documento:')">
                    <span>üìÑ</span> Analisar Documento
                </button>
                <button class="chip" onclick="usarChip('Resuma em t√≥picos:')">
                    <span>üìù</span> Resumir
                </button>
                <button class="chip" onclick="usarChip('Traduza para o ingl√™s:')">
                    <span>üåç</span> Traduzir
                </button>
                <button class="chip" onclick="usarChip('Me ajude com matem√°tica:')">
                    <span>üî¢</span> Matem√°tica
                </button>
            </div>
        </div>

        <footer>
            <div class="input-tools" id="toolsBar">
                <button class="tool-btn" onclick="ativarModoContexto('criativo')" title="Modo criativo">
                    <span>‚ú®</span> Criativo
                </button>
                <button class="tool-btn" onclick="ativarModoContexto('preciso')" title="Modo preciso">
                    <span>üéØ</span> Preciso
                </button>
                <button class="tool-btn" onclick="ativarModoContexto('codigo')" title="Especialista em c√≥digo">
                    <span>üíª</span> C√≥digo
                </button>
                <button class="tool-btn" onclick="ativarModoContexto('ensino')" title="Modo professor">
                    <span>üéì</span> Ensino
                </button>
                <button class="tool-btn" onclick="ativarModoContexto('analise')" title="An√°lise profunda">
                    <span>üî¨</span> An√°lise
                </button>
            </div>

            <div class="input-area">
                <div class="input-actions">
                    <button id="btn-mic" onclick="ativarMicrofone()" aria-label="Ativar microfone" title="Falar">üé§</button>
                    <button id="btn-attach" onclick="anexarArquivo()" aria-label="Anexar arquivo" title="Anexar">üìé</button>
                </div>

                <div class="input-container">
                    <textarea id="entradaUsuario"
                              placeholder="Digite sua mensagem... (Shift+Enter para nova linha)"
                              rows="1"></textarea>
                    <span class="input-contador" id="contador-chars">0/4000</span>
                </div>

                <button class="btn-send" id="btn-enviar" onclick="enviarMensagem()">
                    Enviar
                </button>
            </div>
        </footer>
    </div>

    <!-- Input oculto para arquivos -->
    <input type="file" id="fileInput" accept=".txt,.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif" multiple class="oculto">
    
    <!-- Container para toasts -->
    <div id="toast-container"></div>

    <script>
        // ===== CONFIGURA√á√ïES =====
        const CONFIG = {
            MISTRAL_API_KEY: 'NFuAj8PYUPcaf6tA1BjbyXuIeSjSA4sW',
            SUPABASE_URL: 'https://onyhbarnwvoqpwveyvhc.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ueWhiYXJud3ZvcXB3dmV5dmhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1OTY0NDQsImV4cCI6MjA3MzE3MjQ0NH0.2zqN73ZxkqxlWLp49Kmrg1CUau0YAi7dee2EIyhodoI',
            MAX_HISTORICO: 15,
            MAX_CHARS: 4000,
            VELOCIDADE_VOZ_PADRAO: 1.0,
            MODELOS_DISPONIVEIS: ['mistral-tiny', 'mistral-small', 'mistral-medium']
        };

        let estado = {
            somAtivado: false,
            velocidadeVoz: CONFIG.VELOCIDADE_VOZ_PADRAO,
            tamanhoFonte: 16,
            temaEscuro: false,
            altoContraste: false,
            leituraFacilitada: false,
            conversaAtual: [],
            aguardandoResposta: false,
            modoContexto: 'normal',
            arquivosAnexados: [],
            reconhecimentoVozAtivo: false
        };

        let supabase = null;
        let reconhecimentoVoz = null;

        // Inicializar Supabase se as credenciais estiverem configuradas
        const urlValida = CONFIG.SUPABASE_URL && CONFIG.SUPABASE_URL !== 'SUA_URL_SUPABASE_AQUI';
        const keyValida = CONFIG.SUPABASE_KEY && CONFIG.SUPABASE_KEY !== 'SUA_CHAVE_SUPABASE_AQUI';

        if (urlValida && keyValida) {
            supabase = window.supabase.createClient(
                CONFIG.SUPABASE_URL,
                CONFIG.SUPABASE_KEY
            );
        } else {
            console.warn("‚ö†Ô∏è Supabase n√£o configurado. Defina SUPABASE_URL e SUPABASE_KEY em CONFIG.");
        }

        // Configurar Marked para processamento de markdown
        marked.setOptions({ 
            breaks: true,
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            }
        });

        // ===== INICIALIZA√á√ÉO =====
        window.onload = () => {
            carregarConfiguracoes();
            carregarHistorico();
            configurarEventos();
            aplicarConfiguracoes();
            verificarSuporteFuncionalidades();
            inicializarReconhecimentoVoz();
            
            // Verificar se √© um PWA instalado
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('Executando como PWA instalado');
                document.body.classList.add('pwa-instalado');
            }
        };

        // ===== NAVEGA√á√ÉO =====
        function irParaAviso() {
            document.getElementById('tela-boas-vindas').classList.add('oculto');
            document.getElementById('tela-aviso').classList.remove('oculto');
        }

        function irParaChat() {
            document.getElementById('tela-aviso').classList.add('oculto');
            document.getElementById('tela-app').classList.remove('oculto');

            const chat = document.getElementById('chat-container');
            if (chat.children.length === 0) {
                setTimeout(() => mostrarMensagemBoasVindas(), 300);
            }
            
            // Focar no campo de entrada ap√≥s um breve delay
            setTimeout(() => {
                document.getElementById('entradaUsuario').focus();
            }, 500);
        }

        function mostrarMensagemBoasVindas() {
            const mensagem = `# üå∏ Ol√°! Eu sou a **Sena**, sua assistente em desenvolvimento.

Aqui vai um resumo r√°pido do que eu consigo fazer por voc√™:

## üí¨ Conversa√ß√£o Natural
- Respostas claras e diretas
- Capacidade de manter contexto
- Explica√ß√µes f√°ceis at√© quando o assunto tenta complicar

## üíª Programa√ß√£o
- Gera√ß√£o de c√≥digo em m√∫ltiplas linguagens
- Explica√ß√µes t√©cnicas sem enrola√ß√£o
- Corre√ß√£o e otimiza√ß√£o de scripts

## üìÑ Documentos (Beta, pode haver erros)
- An√°lise de textos, PDFs e imagens
- Resumos enxutos ou completos
- Extra√ß√£o de informa√ß√µes relevantes

## üé® Criatividade
- Constru√ß√£o de hist√≥rias, poemas e roteiros
- Desenvolvimento de ideias novas
- Suporte criativo para qualquer projeto

## üî¨ An√°lises
- Compara√ß√µes inteligentes
- Racioc√≠nio detalhado
- Solu√ß√µes para problemas complexos

## üåç Idiomas
- Tradu√ß√µes naturais
- Explica√ß√µes gramaticais
- Ajuda no aprendizado de outros idiomas

Pronto para come√ßar?`;

            adicionarMensagem(mensagem, 'cici', false);
        }

        function abrirMenu() {
            document.getElementById('side-menu').classList.add('aberto');
            document.getElementById('overlay-menu').classList.add('aberto');
            document.body.style.overflow = 'hidden';
        }

        function fecharMenu() {
            document.getElementById('side-menu').classList.remove('aberto');
            document.getElementById('overlay-menu').classList.remove('aberto');
            document.body.style.overflow = '';
        }

        function novaConversa() {
            if (estado.conversaAtual.length === 0) {
                mostrarToast('J√° est√° em uma conversa nova', 'info');
                return;
            }
            
            if (confirm('Deseja iniciar uma nova conversa? A conversa atual ser√° salva.')) {
                const timestamp = Date.now();
                localStorage.setItem(`senaChat_${timestamp}`, JSON.stringify(estado.conversaAtual));
                limparChat();
                setTimeout(() => mostrarMensagemBoasVindas(), 300);
                mostrarToast('Nova conversa iniciada!', 'sucesso');
            }
        }

        // ===== CONFIGURA√á√ïES E PREFER√äNCIAS =====
        function carregarConfiguracoes() {
            const configs = JSON.parse(localStorage.getItem('senaConfigs') || '{}');
            estado = { ...estado, ...configs };
            
            // Verificar configura√ß√µes espec√≠ficas
            if (localStorage.getItem('altoContraste') === 'true') {
                estado.altoContraste = true;
            }
            
            // Verificar tema do sistema
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                estado.temaEscuro = true;
            }
        }

        function salvarConfiguracoes() {
            localStorage.setItem('senaConfigs', JSON.stringify(estado));
            localStorage.setItem('altoContraste', estado.altoContraste);
        }

        function aplicarConfiguracoes() {
            // Aplicar tema
            if (estado.temaEscuro) {
                document.body.classList.add('tema-escuro');
                document.getElementById('toggle-tema').classList.add('ativo');
                document.getElementById('icone-tema').textContent = '‚òÄÔ∏è';
                document.getElementById('texto-tema').textContent = 'Modo Claro';
            }
            
            // Aplicar alto contraste
            if (estado.altoContraste) {
                document.body.classList.add('alto-contraste');
                document.getElementById('toggle-contraste').classList.add('ativo');
            }
            
            // Aplicar leitura facilitada
            if (estado.leituraFacilitada) {
                document.body.classList.add('leitura-facilitada');
                document.getElementById('toggle-leitura').classList.add('ativo');
            }
            
            // Aplicar configura√ß√µes de √°udio
            if (estado.somAtivado) {
                document.getElementById('toggle-som').classList.add('ativo');
                document.getElementById('icone-som').textContent = 'üîä';
                document.getElementById('texto-som').textContent = 'Desativar Voz';
            }
            
            // Aplicar tamanho da fonte
            document.documentElement.style.fontSize = estado.tamanhoFonte + 'px';
        }

        function configurarEventos() {
            const input = document.getElementById('entradaUsuario');

            // Eventos de teclado para o campo de entrada
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    enviarMensagem();
                }
            });

            input.addEventListener('input', () => {
                autoResizeTextarea(input);
                const contador = document.getElementById('contador-chars');
                contador.textContent = `${input.value.length}/${CONFIG.MAX_CHARS}`;
                
                if (input.value.length > CONFIG.MAX_CHARS * 0.9) {
                    contador.style.color = 'var(--danger)';
                } else {
                    contador.style.color = 'var(--text-secondary)';
                }
            });

            // Eventos de teclado globais
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    input.focus();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                    e.preventDefault();
                    limparChat();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    exportarConversa();
                }
                if (e.key === 'Escape') {
                    fecharMenu();
                }
            });

            // Eventos de toque para melhor experi√™ncia m√≥vel
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // Prevenir zoom em duplo toque
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // Configurar input de arquivo
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', processarArquivos);
            }
            
            // Configurar gestos para o menu lateral
            configurarGestosMenu();
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function configurarGestosMenu() {
            const menu = document.getElementById('side-menu');
            const overlay = document.getElementById('overlay-menu');
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            overlay.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });

            overlay.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                currentX = e.touches[0].clientX;
                const diff = currentX - startX;
                
                if (diff < 0) {
                    menu.style.transform = `translateX(${diff}px)`;
                }
            });

            overlay.addEventListener('touchend', () => {
                if (!isDragging) return;
                
                isDragging = false;
                const diff = currentX - startX;
                
                if (diff < -50) {
                    fecharMenu();
                }
                
                menu.style.transform = '';
            });
        }

        function verificarSuporteFuncionalidades() {
            // Verificar suporte a reconhecimento de voz
            const temReconhecimentoVoz = 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;
            if (!temReconhecimentoVoz) {
                const btnMic = document.getElementById('btn-mic');
                if (btnMic) btnMic.style.display = 'none';
            }

            // Verificar suporte a s√≠ntese de voz
            const temSinteseVoz = 'speechSynthesis' in window;
            if (!temSinteseVoz) {
                estado.somAtivado = false;
                document.getElementById('toggle-som').style.display = 'none';
            }

            // Verificar suporte a compartilhamento
            const temCompartilhamento = 'share' in navigator;
            if (!temCompartilhamento) {
                // Ocultar op√ß√µes de compartilhamento que dependem da API
            }
        }

        function inicializarReconhecimentoVoz() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (SpeechRecognition) {
                reconhecimentoVoz = new SpeechRecognition();
                reconhecimentoVoz.continuous = false;
                reconhecimentoVoz.interimResults = false;
                reconhecimentoVoz.lang = 'pt-BR';

                reconhecimentoVoz.onstart = () => {
                    estado.reconhecimentoVozAtivo = true;
                    document.getElementById('btn-mic').classList.add('ouvindo');
                    mostrarToast('üé§ Estou ouvindo...', 'aviso');
                };

                reconhecimentoVoz.onend = () => {
                    estado.reconhecimentoVozAtivo = false;
                    document.getElementById('btn-mic').classList.remove('ouvindo');
                };

                reconhecimentoVoz.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('entradaUsuario').value = transcript;
                    document.getElementById('entradaUsuario').focus();
                    autoResizeTextarea(document.getElementById('entradaUsuario'));
                    mostrarToast('‚úì Texto capturado!', 'sucesso');
                };

                reconhecimentoVoz.onerror = (event) => {
                    estado.reconhecimentoVozAtivo = false;
                    document.getElementById('btn-mic').classList.remove('ouvindo');
                    
                    let mensagem = 'Erro ao capturar voz';
                    if (event.error === 'no-speech') {
                        mensagem = 'Nenhuma fala detectada';
                    } else if (event.error === 'audio-capture') {
                        mensagem = 'Nenhum microfone detectado';
                    } else if (event.error === 'not-allowed') {
                        mensagem = 'Permiss√£o de microfone negada';
                    }
                    
                    mostrarToast(mensagem, 'erro');
                };
            }
        }

        // ===== APAR√äNCIA =====
        function alternarTemaEscuro() {
            estado.temaEscuro = !estado.temaEscuro;
            document.body.classList.toggle('tema-escuro');
            
            const toggle = document.getElementById('toggle-tema');
            const icone = document.getElementById('icone-tema');
            const texto = document.getElementById('texto-tema');
            
            if (estado.temaEscuro) {
                toggle.classList.add('ativo');
                icone.textContent = '‚òÄÔ∏è';
                texto.textContent = 'Modo Claro';
            } else {
                toggle.classList.remove('ativo');
                icone.textContent = 'üåô';
                texto.textContent = 'Modo Escuro';
            }
            
            salvarConfiguracoes();
            mostrarToast('Tema alterado!', 'sucesso');
        }

        function alternarContraste() {
            estado.altoContraste = !estado.altoContraste;
            document.body.classList.toggle('alto-contraste');
            document.getElementById('toggle-contraste').classList.toggle('ativo');
            
            salvarConfiguracoes();
            mostrarToast('Alto contraste ' + (estado.altoContraste ? 'ativado' : 'desativado'), 'sucesso');
        }

        function alternarLeituraFacilitada() {
            estado.leituraFacilitada = !estado.leituraFacilitada;
            document.body.classList.toggle('leitura-facilitada');
            document.getElementById('toggle-leitura').classList.toggle('ativo');
            
            salvarConfiguracoes();
            mostrarToast('Leitura facilitada ' + (estado.leituraFacilitada ? 'ativada' : 'desativada'), 'sucesso');
        }

        function ajustarFonte(incremento) {
            estado.tamanhoFonte = Math.max(12, Math.min(28, estado.tamanhoFonte + incremento));
            document.documentElement.style.fontSize = estado.tamanhoFonte + 'px';
            
            salvarConfiguracoes();
            mostrarToast(`Tamanho: ${estado.tamanhoFonte}px`, 'sucesso');
        }

        function resetarFonte() {
            estado.tamanhoFonte = 16;
            document.documentElement.style.fontSize = '16px';
            
            salvarConfiguracoes();
            mostrarToast('Tamanho padr√£o restaurado', 'sucesso');
        }

        // ===== √ÅUDIO =====
        function alternarSom() {
            // Verificar se o navegador suporta s√≠ntese de voz
            if (!('speechSynthesis' in window)) {
                mostrarToast('Seu navegador n√£o suporta s√≠ntese de voz', 'erro');
                return;
            }
            
            estado.somAtivado = !estado.somAtivado;
            
            const toggle = document.getElementById('toggle-som');
            const icone = document.getElementById('icone-som');
            const texto = document.getElementById('texto-som');
            
            if (estado.somAtivado) {
                toggle.classList.add('ativo');
                icone.textContent = 'üîä';
                texto.textContent = 'Desativar Voz';
                falar('Voz ativada com sucesso!');
            } else {
                toggle.classList.remove('ativo');
                icone.textContent = 'üîá';
                texto.textContent = 'Ativar Voz';
                window.speechSynthesis.cancel();
            }
            
            salvarConfiguracoes();
        }

        function ajustarVelocidadeVoz(incremento) {
            estado.velocidadeVoz = Math.max(0.5, Math.min(2.0, estado.velocidadeVoz + incremento));
            
            salvarConfiguracoes();
            
            const velocidadeTexto = estado.velocidadeVoz === 1.0 ? 'normal' : 
                                   estado.velocidadeVoz < 1.0 ? 'lenta' : 'r√°pida';
            
            mostrarToast(`Velocidade da voz: ${velocidadeTexto}`, 'sucesso');
            
            if (estado.somAtivado) {
                falar('Teste de velocidade da voz');
            }
        }

        function falar(texto) {
            if (!estado.somAtivado || !('speechSynthesis' in window)) return;
            
            // Cancelar qualquer fala em andamento
            window.speechSynthesis.cancel();
            
            // Limpar o texto de formata√ß√£o markdown
            const textoLimpo = texto
                .replace(/[*_#`]/g, '')
                .replace(/<[^>]*>/g, '')
                .replace(/\n+/g, '. ')
                .substring(0, 200); // Limitar o tamanho para evitar problemas
            
            const utterance = new SpeechSynthesisUtterance(textoLimpo);
            utterance.lang = 'pt-BR';
            utterance.rate = estado.velocidadeVoz;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            utterance.onerror = (event) => {
                console.error('Erro na s√≠ntese de voz:', event);
            };
            
            window.speechSynthesis.speak(utterance);
        }

        function ativarMicrofone() {
            if (!reconhecimentoVoz) {
                mostrarToast('Reconhecimento de voz n√£o dispon√≠vel', 'erro');
                return;
            }
            
            if (estado.reconhecimentoVozAtivo) {
                reconhecimentoVoz.stop();
                return;
            }
            
            try {
                reconhecimentoVoz.start();
            } catch (error) {
                console.error('Erro ao iniciar reconhecimento de voz:', error);
                mostrarToast('Erro ao acessar o microfone', 'erro');
            }
        }

        // ===== MODOS DE CONTEXTO =====
        function ativarModoContexto(modo) {
            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('ativo');
            });
            
            // Adicionar classe ativa ao bot√£o clicado
            event.target.closest('.tool-btn').classList.add('ativo');
            
            estado.modoContexto = modo;

            const modos = {
                criativo: '‚ú® Modo Criativo ativado - Respostas mais imaginativas',
                preciso: 'üéØ Modo Preciso ativado - Respostas mais factuais',
                codigo: 'üíª Modo C√≥digo ativado - Especialista em programa√ß√£o',
                ensino: 'üéì Modo Ensino ativado - Explica√ß√µes did√°ticas',
                analise: 'üî¨ Modo An√°lise ativado - An√°lises profundas'
            };

            mostrarToast(modos[modo], 'sucesso');
        }

        // ===== ANEXAR ARQUIVOS =====
        function anexarArquivo() {
            document.getElementById('fileInput').click();
        }

        async function processarArquivos(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            for (const file of files) {
                // Verificar tamanho do arquivo (m√°ximo 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    mostrarToast(`Arquivo ${file.name} muito grande (m√°x 10MB)`, 'erro');
                    continue;
                }

                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    const conteudo = e.target.result;
                    const tipoArquivo = file.type.startsWith('image/') ? 'imagem' : 'documento';

                    estado.arquivosAnexados.push({
                        nome: file.name,
                        tipo: tipoArquivo,
                        tamanho: file.size,
                        conteudo: conteudo
                    });

                    mostrarArquivoAnexado(file.name, file.size, tipoArquivo);
                    mostrarToast(`‚úì ${file.name} anexado!`, 'sucesso');
                };

                reader.onerror = () => {
                    mostrarToast(`Erro ao ler o arquivo ${file.name}`, 'erro');
                };

                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsText(file, 'UTF-8');
                }
            }

            // Limpar o input para permitir selecionar o mesmo arquivo novamente
            event.target.value = '';
        }

        function mostrarArquivoAnexado(nome, tamanho, tipo) {
            const chat = document.getElementById('chat-container');
            const wrapper = document.createElement('div');
            wrapper.className = 'mensagem-wrapper usuario-wrapper';

            const icones = {
                'imagem': 'üñºÔ∏è',
                'documento': 'üìÑ'
            };

            wrapper.innerHTML = `
                <div class="mensagem usuario">
                    <div class="file-attachment">
                        <div class="file-icon">${icones[tipo]}</div>
                        <div class="file-info">
                            <div class="file-name">${nome}</div>
                            <div class="file-size">${formatarTamanho(tamanho)}</div>
                        </div>
                    </div>
                </div>
                <div class="mensagem-hora">${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</div>
            `;

            chat.appendChild(wrapper);
            chat.scrollTop = chat.scrollHeight;
        }

        function formatarTamanho(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // ===== ENVIAR MENSAGEM =====
        function usarChip(texto) {
            const input = document.getElementById('entradaUsuario');
            input.value = texto + ' ';
            input.focus();
            autoResizeTextarea(input);
        }

        async function enviarMensagem() {
            const input = document.getElementById('entradaUsuario');
            const texto = input.value.trim();

            // Verificar se h√° conte√∫do para enviar
            if (!texto && estado.arquivosAnexados.length === 0) {
                mostrarToast('Digite uma mensagem ou anexe um arquivo', 'aviso');
                return;
            }
            
            // Verificar se j√° est√° aguardando uma resposta
            if (estado.aguardandoResposta) {
                mostrarToast('Aguarde a resposta anterior', 'aviso');
                return;
            }

            let mensagemCompleta = texto;

            // Adicionar informa√ß√£o sobre arquivos anexados
            if (estado.arquivosAnexados.length > 0) {
                mensagemCompleta += `\n\n[Arquivos anexados: ${estado.arquivosAnexados.map(a => a.nome).join(', ')}]`;
            }

            // Adicionar mensagem do usu√°rio ao chat
            adicionarMensagem(mensagemCompleta, 'usuario', true);
            
            // Limpar campo de entrada
            input.value = '';
            autoResizeTextarea(input);
            document.getElementById('contador-chars').textContent = '0/4000';

            // Desativar bot√£o de enviar enquanto processa
            estado.aguardandoResposta = true;
            document.getElementById('btn-enviar').disabled = true;

            // Mostrar indicador de digita√ß√£o
            mostrarIndicadorDigitacao();

            try {
                // Obter resposta da IA
                const resposta = await obterRespostaIA(mensagemCompleta);
                
                // Remover indicador de digita√ß√£o e adicionar resposta
                removerIndicadorDigitacao();
                adicionarMensagem(resposta, 'cici', true);

                // Reproduzir resposta por voz se ativado
                if (estado.somAtivado) {
                    falar(resposta);
                }
            } catch (erro) {
                // Tratar erros
                removerIndicadorDigitacao();
                adicionarMensagem('Desculpe, ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.', 'cici', false);
                mostrarToast('Erro ao comunicar com a IA', 'erro');
                console.error('Erro:', erro);
            } finally {
                // Reativar bot√£o e limpar estado
                estado.aguardandoResposta = false;
                document.getElementById('btn-enviar').disabled = false;
                estado.arquivosAnexados = [];
            }
        }

        function mostrarIndicadorDigitacao() {
            const chat = document.getElementById('chat-container');
            const wrapper = document.createElement('div');
            wrapper.className = 'mensagem-wrapper cici-wrapper';
            wrapper.id = 'indicador-digitacao';
            wrapper.innerHTML = `
                <div class="mensagem cici">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chat.appendChild(wrapper);
            chat.scrollTop = chat.scrollHeight;
        }

        function removerIndicadorDigitacao() {
            const indicador = document.getElementById('indicador-digitacao');
            if (indicador) indicador.remove();
        }

        function adicionarMensagem(texto, remetente, salvar = true) {
            const chat = document.getElementById('chat-container');
            const wrapper = document.createElement('div');
            wrapper.className = `mensagem-wrapper ${remetente}-wrapper`;

            const agora = new Date();
            const hora = agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

            const mensagemDiv = document.createElement('div');
            mensagemDiv.className = `mensagem ${remetente}`;

            // Processar markdown para mensagens da Sena
            if (remetente === 'cici') {
                mensagemDiv.innerHTML = marked.parse(texto);

                // Adicionar bot√µes de copiar para blocos de c√≥digo
                mensagemDiv.querySelectorAll('pre code').forEach((block) => {
                    const pre = block.parentElement;
                    const wrapper = document.createElement('div');
                    wrapper.style.position = 'relative';

                    const header = document.createElement('div');
                    header.className = 'code-header';

                    const language = block.className.replace('language-', '').replace('hljs', '').trim() || 'code';
                    header.innerHTML = `
                        <span class="code-language">${language}</span>
                        <button class="code-copy-btn" onclick="copiarCodigo(this)">üìã Copiar</button>
                    `;

                    pre.parentNode.insertBefore(wrapper, pre);
                    wrapper.appendChild(header);
                    wrapper.appendChild(pre);
                });
            } else {
                // Para mensagens do usu√°rio, usar texto simples
                const textoFormatado = document.createElement('div');
                textoFormatado.textContent = texto;
                mensagemDiv.appendChild(textoFormatado);
            }

            const horaDiv = document.createElement('div');
            horaDiv.className = 'mensagem-hora';
            horaDiv.textContent = hora;

            wrapper.appendChild(mensagemDiv);
            wrapper.appendChild(horaDiv);

            // Adicionar a√ß√µes para mensagens da Sena
            if (remetente === 'cici') {
                const acoesDiv = document.createElement('div');
                acoesDiv.className = 'mensagem-acoes';
                acoesDiv.innerHTML = `
                    <button class="btn-acao" onclick="copiarMensagem(this)">
                        <span>üìã</span> Copiar
                    </button>
                    <button class="btn-acao" onclick="compartilharMensagem(this)">
                        <span>üì§</span> Compartilhar
                    </button>
                    ${estado.somAtivado ? `
                        <button class="btn-acao" onclick="repetirAudio(this)">
                            <span>üîä</span> Repetir
                        </button>
                    ` : ''}
                `;
                wrapper.appendChild(acoesDiv);
            }

            chat.appendChild(wrapper);
            chat.scrollTop = chat.scrollHeight;

            // Salvar no hist√≥rico se necess√°rio
            if (salvar) {
                estado.conversaAtual.push({ 
                    texto, 
                    remetente, 
                    timestamp: Date.now() 
                });
                salvarHistorico();
            }
        }

        function copiarCodigo(btn) {
            const pre = btn.closest('div').nextElementSibling;
            const codigo = pre.textContent;
            
            navigator.clipboard.writeText(codigo).then(() => {
                const textoOriginal = btn.textContent;
                btn.textContent = '‚úì Copiado!';
                setTimeout(() => btn.textContent = textoOriginal, 2000);
                mostrarToast('C√≥digo copiado!', 'sucesso');
            }).catch(err => {
                console.error('Erro ao copiar c√≥digo:', err);
                mostrarToast('Erro ao copiar c√≥digo', 'erro');
            });
        }

        function copiarMensagem(btn) {
            const mensagem = btn.closest('.mensagem-wrapper').querySelector('.mensagem');
            const texto = mensagem.textContent || mensagem.innerText;
            
            navigator.clipboard.writeText(texto).then(() => {
                mostrarToast('Mensagem copiada!', 'sucesso');
            }).catch(err => {
                console.error('Erro ao copiar mensagem:', err);
                mostrarToast('Erro ao copiar mensagem', 'erro');
            });
        }

        function compartilharMensagem(btn) {
            const mensagem = btn.closest('.mensagem-wrapper').querySelector('.mensagem');
            const texto = mensagem.textContent || mensagem.innerText;

            if (navigator.share) {
                navigator.share({
                    title: 'Sena AI',
                    text: texto
                }).catch(err => {
                    console.error('Erro ao compartilhar:', err);
                    // Fallback para copiar
                    copiarMensagem(btn);
                });
            } else {
                // Fallback para copiar
                copiarMensagem(btn);
                mostrarToast('Texto copiado para compartilhar', 'sucesso');
            }
        }

        function repetirAudio(btn) {
            const mensagem = btn.closest('.mensagem-wrapper').querySelector('.mensagem');
            const texto = mensagem.textContent || mensagem.innerText;
            falar(texto);
        }

        // ===== API IA =====
        async function obterRespostaIA(mensagemUsuario) {
            const systemPrompt = getSystemPromptPorModo(estado.modoContexto);

            // Construir hist√≥rico de mensagens para contexto
            const mensagens = [
                { role: 'system', content: systemPrompt },
                ...estado.conversaAtual.slice(-CONFIG.MAX_HISTORICO).map(m => ({
                    role: m.remetente === 'usuario' ? 'user' : 'assistant',
                    content: m.texto
                })),
                { role: 'user', content: mensagemUsuario }
            ];

            // Fazer requisi√ß√£o para a API Mistral
            const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${CONFIG.MISTRAL_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'mistral-small-latest',
                    messages: mensagens,
                    temperature: estado.modoContexto === 'criativo' ? 0.9 : 0.7,
                    max_tokens: 2000,
                    stream: false
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Erro na API: ${response.status} - ${errorText}`);
            }

            const data = await response.json();
            
            if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                throw new Error('Resposta da API em formato inesperado');
            }
            
            return data.choices[0].message.content;
        }

        function getSystemPromptPorModo(modo) {
            const prompts = {
                normal: `Voc√™ √© Sena, uma assistente AI multifuncional desenvolvida pela Orpheo Studio. 
Seja prestativa, clara e objetiva. Responda em portugu√™s brasileiro, a menos que solicitado em outro idioma.
Forne√ßa respostas √∫teis e informativas, sendo honesta sobre suas limita√ß√µes quando necess√°rio.`,

                criativo: `Voc√™ √© Sena no modo criativo. Seja imaginativa, use met√°foras e analogias interessantes.
Incentive a criatividade do usu√°rio e forne√ßa ideias originais. Seja inspiradora e encorajadora.`,

                preciso: `Voc√™ √© Sena no modo preciso. Seja factual, concisa e baseie suas respostas em informa√ß√µes verific√°veis.
Priorize a precis√£o sobre a criatividade. Se ciente de suas limita√ß√µes e n√£o invente informa√ß√µes.`,

                codigo: `Voc√™ √© Sena no modo programa√ß√£o. Especialista em c√≥digo e desenvolvimento de software.
Forne√ßa c√≥digo limpo, bem comentado e explique suas solu√ß√µes. Considere boas pr√°ticas e performance.
Seja precisa com sintaxe e detalhes t√©cnicos.`,

                ensino: `Voc√™ √© Sena no modo professor. Explique conceitos de forma did√°tica, use exemplos e verifique o entendimento.
Adapte sua explica√ß√£o ao n√≠vel de conhecimento do usu√°rio. Seja paciente e encorajadora.`,

                analise: `Voc√™ √© Sena no modo an√°lise. Fa√ßa an√°lises profundas, considere m√∫ltiplas perspectivas e forne√ßa insights detalhados.
Estruture seu racioc√≠nio de forma l√≥gica e apresente conclus√µes bem fundamentadas.`
            };
            
            return prompts[modo] || prompts.normal;
        }

        // ===== HIST√ìRICO =====
        function salvarHistorico() {
            try {
                localStorage.setItem('senaHistorico', JSON.stringify(estado.conversaAtual));
                
                // Tamb√©m salvar no Supabase se configurado
                if (supabase && estado.conversaAtual.length > 0) {
                    // Implementar salvamento no Supabase se necess√°rio
                }
            } catch (e) {
                console.error('Erro ao salvar hist√≥rico:', e);
                // Tentar salvar apenas as mensagens mais recentes se houver erro de quota
                if (e.name === 'QuotaExceededError') {
                    estado.conversaAtual = estado.conversaAtual.slice(-10);
                    localStorage.setItem('senaHistorico', JSON.stringify(estado.conversaAtual));
                    mostrarToast('Hist√≥rico limitado devido ao espa√ßo', 'aviso');
                }
            }
        }

        function carregarHistorico() {
            try {
                const historico = localStorage.getItem('senaHistorico');
                if (historico) {
                    estado.conversaAtual = JSON.parse(historico);
                    
                    // Adicionar mensagens ao chat
                    estado.conversaAtual.forEach(msg => {
                        adicionarMensagem(msg.texto, msg.remetente, false);
                    });
                    
                    // Rolar para a √∫ltima mensagem
                    const chat = document.getElementById('chat-container');
                    if (chat) {
                        setTimeout(() => {
                            chat.scrollTop = chat.scrollHeight;
                        }, 100);
                    }
                }
            } catch (e) {
                console.error('Erro ao carregar hist√≥rico:', e);
                // Limpar hist√≥rico corrompido
                localStorage.removeItem('senaHistorico');
                estado.conversaAtual = [];
            }
        }

        function limparChat() {
            if (estado.conversaAtual.length === 0) {
                mostrarToast('N√£o h√° conversa para limpar', 'info');
                return;
            }
            
            if (confirm('Deseja realmente limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.')) {
                document.getElementById('chat-container').innerHTML = '';
                estado.conversaAtual = [];
                salvarHistorico();
                mostrarToast('Conversa limpa!', 'sucesso');
            }
        }

        // ===== EXPORTAR E COMPARTILHAR =====
        function exportarConversa() {
            if (estado.conversaAtual.length === 0) {
                mostrarToast('Nenhuma conversa para exportar', 'aviso');
                return;
            }

            let texto = '=== CONVERSA Sena ===\n\n';
            estado.conversaAtual.forEach(msg => {
                const remetente = msg.remetente === 'usuario' ? 'VOC√ä' : 'SENA';
                const data = new Date(msg.timestamp).toLocaleString('pt-BR');
                texto += `[${data}] ${remetente}:\n${msg.texto}\n\n`;
            });

            const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sena-conversa-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            mostrarToast('Conversa exportada!', 'sucesso');
        }

        function compartilharConversa() {
            if (estado.conversaAtual.length === 0) {
                mostrarToast('Nenhuma conversa para compartilhar', 'aviso');
                return;
            }

            let texto = 'Conversa com Sena AI:\n\n';
            // Pegar apenas as √∫ltimas 5 mensagens para n√£o ficar muito longo
            estado.conversaAtual.slice(-5).forEach(msg => {
                const remetente = msg.remetente === 'usuario' ? 'Eu' : 'Sena';
                texto += `${remetente}: ${msg.texto}\n\n`;
            });

            if (navigator.share) {
                navigator.share({
                    title: 'Conversa Sena AI',
                    text: texto
                }).catch(err => {
                    console.error('Erro ao compartilhar:', err);
                    // Fallback para copiar
                    navigator.clipboard.writeText(texto).then(() => {
                        mostrarToast('Conversa copiada!', 'sucesso');
                    });
                });
            } else {
                // Fallback para copiar
                navigator.clipboard.writeText(texto).then(() => {
                    mostrarToast('Conversa copiada!', 'sucesso');
                }).catch(err => {
                    console.error('Erro ao copiar:', err);
                    mostrarToast('Erro ao copiar conversa', 'erro');
                });
            }
        }

        function imprimirConversa() {
            if (estado.conversaAtual.length === 0) {
                mostrarToast('Nenhuma conversa para imprimir', 'aviso');
                return;
            }
            
            // Criar uma nova janela para impress√£o
            const janelaImpressao = window.open('', '_blank');
            janelaImpressao.document.write(`
                <html>
                    <head>
                        <title>Conversa Sena</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .mensagem { margin-bottom: 15px; padding: 10px; border-radius: 10px; }
                            .usuario { background: #f0f0f0; margin-left: 20%; }
                            .cici { background: #6c5ce7; color: white; margin-right: 20%; }
                            .hora { font-size: 12px; color: #666; margin-top: 5px; }
                            @media print {
                                body { margin: 0; }
                                .mensagem { break-inside: avoid; }
                            }
                        </style>
                    </head>
                    <body>
                        <h1>Conversa com Sena AI</h1>
                        <p>Exportado em: ${new Date().toLocaleString('pt-BR')}</p>
                        <div id="conteudo">
            `);
            
            estado.conversaAtual.forEach(msg => {
                const classe = msg.remetente === 'usuario' ? 'usuario' : 'cici';
                const remetente = msg.remetente === 'usuario' ? 'Voc√™' : 'Sena';
                const hora = new Date(msg.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                janelaImpressao.document.write(`
                    <div class="mensagem ${classe}">
                        <strong>${remetente}:</strong><br>
                        ${msg.texto.replace(/\n/g, '<br>')}
                        <div class="hora">${hora}</div>
                    </div>
                `);
            });
            
            janelaImpressao.document.write(`
                        </div>
                    </body>
                </html>
            `);
            janelaImpressao.document.close();
            
            // Aguardar o carregamento e ent√£o imprimir
            janelaImpressao.onload = () => {
                janelaImpressao.print();
                // Fechar a janela ap√≥s um tempo se n√£o foi cancelada
                setTimeout(() => {
                    if (!janelaImpressao.closed) {
                        janelaImpressao.close();
                    }
                }, 1000);
            };
        }

        // ===== AJUDA =====
        function mostrarAjuda() {
            const ajuda = `# üìö Como Usar a Sena

## üí¨ Conversa√ß√£o
- Digite sua mensagem e pressione Enter (Shift+Enter para nova linha)
- Use o microfone üé§ para falar sua mensagem
- Anexe arquivos üìé para an√°lise

## ‚å®Ô∏è Atalhos de Teclado
- **Ctrl/Cmd + K**: Focar no campo de mensagem
- **Ctrl/Cmd + L**: Limpar conversa
- **Ctrl/Cmd + S**: Salvar conversa
- **Esc**: Fechar menu

## üé® Modos de Contexto
- **Criativo**: Respostas imaginativas
- **Preciso**: Informa√ß√µes factuais
- **C√≥digo**: Programa√ß√£o especializada
- **Ensino**: Explica√ß√µes did√°ticas
- **An√°lise**: An√°lises profundas

## üì± Recursos
- Anexar documentos e imagens
- Reconhecimento de voz
- S√≠ntese de voz
- Alto contraste
- Leitura facilitada
- Exportar conversas

Use o menu ‚ò∞ para acessar todas as configura√ß√µes!`;

            adicionarMensagem(ajuda, 'cici', false);
            fecharMenu();
        }

        function mostrarCapacidades() {
            const capacidades = `# üöÄ Capacidades da Sena

## üíª Programa√ß√£o
- Gero c√≥digo em Python, JavaScript, Java, C++, e mais
- Depuro e explico c√≥digo existente
- Crio algoritmos e estruturas de dados
- Ajudo com frameworks e bibliotecas

## üìÑ Documentos
- Analiso PDFs e documentos de texto
- Resumo conte√∫dos longos
- Extraio informa√ß√µes espec√≠ficas
- Comparo documentos

## üåç Idiomas
- Traduzo entre v√°rios idiomas
- Explico gram√°tica e vocabul√°rio
- Corrijo textos
- Ensino pron√∫ncia

## üî¨ An√°lise
- Analiso dados e estat√≠sticas
- Resolvo problemas matem√°ticos
- Fa√ßo an√°lises cr√≠ticas
- Comparo informa√ß√µes

## üé® Criatividade
- Escrevo hist√≥rias e poemas
- Crio roteiros e di√°logos
- Gero ideias criativas
- Ajudo com brainstorming

## üìö Educa√ß√£o
- Explico conceitos complexos
- Crio exerc√≠cios e exemplos
- Auxilio em trabalhos escolares
- Preparo para provas

Experimente! Estou aqui para ajudar! üòä`;

            adicionarMensagem(capacidades, 'cici', false);
            fecharMenu();
        }

        function mostrarAtalhos() {
            const atalhos = `# ‚å®Ô∏è Atalhos de Teclado

## Navega√ß√£o
- **Ctrl/Cmd + K**: Focar no campo de mensagem
- **Enter**: Enviar mensagem
- **Shift + Enter**: Nova linha
- **Esc**: Fechar menu lateral

## A√ß√µes
- **Ctrl/Cmd + L**: Limpar conversa
- **Ctrl/Cmd + S**: Salvar/Exportar conversa
- **Ctrl/Cmd + N**: Nova conversa

## Dicas
- Use as sugest√µes r√°pidas (chips) para come√ßar
- Experimente os diferentes modos de contexto
- Anexe arquivos para an√°lise mais completa
- Ative o microfone para ditado por voz`;

            adicionarMensagem(atalhos, 'cici', false);
            fecharMenu();
        }

        // ===== TOAST =====
        function mostrarToast(mensagem, tipo = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${tipo}`;

            const icones = {
                sucesso: '‚úì',
                erro: '‚úï',
                aviso: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };

            toast.innerHTML = `
                <span style="font-size:1.4em">${icones[tipo]}</span>
                <span>${mensagem}</span>
            `;

            document.getElementById('toast-container').appendChild(toast);

            // Anima√ß√£o de entrada
            setTimeout(() => toast.classList.add('mostrar'), 10);

            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                toast.classList.remove('mostrar');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 400);
            }, 3000);
        }

        // ===== PWA E INSTALA√á√ÉO =====
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Tentar registrar o service worker
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registrado com sucesso: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('Falha no registro do ServiceWorker: ', registrationError);
                    });
            });
        }

        // Detectar se o app est√° sendo executado em modo standalone (PWA)
        window.addEventListener('DOMContentLoaded', () => {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('Executando como PWA instalado');
                document.body.classList.add('pwa-instalado');
                
                // Ajustes espec√≠ficos para PWA
                if (navigator.userAgent.includes('Android')) {
                    // Ajustes espec√≠ficos para Android
                } else if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
                    // Ajustes espec√≠ficos para iOS
                }
            }
        });

        // Prevenir comportamento padr√£o de gestos em PWA
        document.addEventListener('touchmove', function(e) {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // Gerenciar estado online/offline
        window.addEventListener('online', () => {
            mostrarToast('Conex√£o restaurada', 'sucesso');
        });

        window.addEventListener('offline', () => {
            mostrarToast('Sem conex√£o com a internet', 'erro');
        });

        // Prevenir sa√≠da acidental em PWA
        window.addEventListener('beforeunload', (e) => {
            if (estado.conversaAtual.length > 0) {
                e.preventDefault();
                e.returnValue = 'Voc√™ tem uma conversa em andamento. Tem certeza que deseja sair?';
            }
        });
    </script>
</body>
</html>